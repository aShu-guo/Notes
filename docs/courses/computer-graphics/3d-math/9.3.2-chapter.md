# 四元数

那么如何将复数从2D扩展到3D中呢，答案是引入三个虚部，分别用`i`、`j`、`k`表示，并且满足

$$
\begin{align}
\\
&\quad i^{2}=j^{2}=k^{2}=ijk=-1 \\
\end{align}
$$

进而可知

![img.png](/imgs/computes-course/quaternion.png)

放到表格中有

![img.png](/imgs/computes-course/quaternion-1.png)

那么一个四元数定义了3D中的复数

$$
w+xi+yj+zk
$$

可以记作

$$
\left [ w,x,y,z \right ]
$$

也可以简化记作

$$
\left [ w,v \right ]
$$

同样的，3D中的复数（即四元数）也满足2D中复数的运算规则，而且也支持旋转3D向量旋转

## 负四元数

将实部和虚部都取复数即可

$$
-q=\begin{bmatrix}
-w  &-v
\end{bmatrix}
=\begin{bmatrix}
-w  &-x&-y&-z
\end{bmatrix}
$$

3D中任意角位移都有两个不同的四元数表示，而且它们互相为负

## 加法和减法

四元数的加减法与复数计算规则相同，只需要将对应位置的值相加减即可

例如加法：

$$
\begin{align}\\
&\quad
q_{1}+q_{1} & \\
&\quad = w_{1}+x_{1}i+y_{1}j+z_{1}k+(w_{2}+x_{2}i+y_{2}j+z_{2}k)\\
&\quad =w_{1}+w_{2}+(x_{1}+x_{2})i+(y_{1}+y_{2})j+(z_{1}+z_{2})k
\end{align}
$$

简化为

$$
q_{1}+q_{1}=\left [ w_{1}+w_{2}, v_{1}+v_{2}\right ]
$$

## 单位四元数

如果一个四元数的虚部都为0，那么称这个四元数为单位四元数

$$
q=1+0x+0y+0z=1
$$

同样的，任意四元数乘以单位四元数，结果仍是原四元数

## 共轭和逆

按照共轭复数的形式，定义四元数的共轭时同样将虚部转换符号，并用q<sup>\*</sup>表示

对于四元数`q = w + xi + yj + zk`，它的共轭四元数为

$$
q^{*}=w-xi-bj-zk
$$

同样的按照共轭复数模长的定义，有

$$
q^{*}q={\begin{Vmatrix}
q
\end{Vmatrix}}
$$

四元数的逆用q<sup>-1</sup>表示，将共轭除以模得到

$$
q^{-1}=\frac{q^{*} }{\begin{Vmatrix}
q
\end{Vmatrix}}
$$

四元数的逆和实数的倒数存在有趣的对应关系，对于实数a，有

$$
aa^{-1}=1
$$

对于四元数而言，也存在

$$
qq^{-1}=1
$$

四元数与四元数的逆相乘得到单位四元数`[1,0]`

:::info
虽然四元数不满足交换律，而`共轭四元数与四元数的乘积是满足交换律`的

$$
q^{*}q=qq^{*}={\begin{Vmatrix}
q
\end{Vmatrix}}
$$

对于`单位四元数`而言，由于它的`模长为1`，则有

$$
q^{-1}=q^{*}
$$

:::

## 模

仿照复数的定义，我们可以将四元数`q = w + xi + yj + zk`的模长定义为

$$
\begin{Vmatrix}
q
\end{Vmatrix}=\sqrt{w^{2}+x^{2}+y^{2}+z^{2}} =\sqrt{w^{2}+\begin{Vmatrix}
v
\end{Vmatrix}^{2}}
$$

很难在几何上描述四元数的模长，因为它是在四维空间描述三维空间，只需要理解定义即可

## 纯四元数

如果一个四元数只有虚部，实部为0，那么称这种形式的四元数为纯四元数

$$
q=\left [ 0,v \right ]
$$

因此任意形式的3D向量都可以转换为纯四元数，对于任意3D向量`v`，都有纯四元数

$$
v=\left [ 0,\rm v \right ]
$$

对于两个纯四元数q<sub>1</sub>、q<sub>2</sub>，它们的乘积为

$$
q_{1}q_{2}=\left [ -v_{1}·v_{2},v_{1}\times v_{2} \right ]
$$

## 乘法

### 与标量相乘

与复数相同，四元数与标量的乘积等于标量与四元数每部分都相乘和

$$
a(w+xi+yj+zk)=aw+axi+ayj+azk
$$

也可以简化为

$$
aq=a\left [ w, v\right ]=\left [ aw, av\right ]
$$

### 四元数乘法（叉乘）

分为两种，分别是点乘、叉乘

计算规则与复数乘法相同，但是复数乘法遵循交换律。不用为四元数乘法使用乘号

- 四元数相乘不遵循交换律

$$
q_{1}q_{2}\ne q_{2}q_{1}
$$

- 四元数相乘遵循结合律

$$
(q_{1}q_{2})q_{3}=q_{1}(q_{2}q_{3})
$$

例如：q<sub>1</sub>左乘q<sub>2</sub>结果为

$$
\begin{align}\\
&\quad
q_{1}q_{2} & \\
&\quad = (w_{1}+x_{1}i+y_{1}j+z_{1}k)·(w_{2}+x_{2}i+y_{2}j+z_{2}k)\\
&\quad =w_{1}w_{2}+w_{1}x_{2}i+w_{1}y_{2}j+w_{1}z_{2}k +\\
&\quad \quad\ x_{1}iw_{2}+x_{1}ix_{2}i+x_{1}iy_{2}j+x_{1}iz_{2}k +\\
&\quad \quad\ y_{1}jw_{2}+y_{1}jx_{2}i+y_{1}jy_{2}j+y_{1}jz_{2}k +\\
&\quad \quad\ z_{1}kw_{2}+z_{1}kx_{2}i+z_{1}ky_{2}j+z_{1}kz_{2}k \\ \\
&\quad=w_{1}w_{2}+w_{1}x_{2}i+w_{1}y_{2}j+w_{1}z_{2}k +\\
&\quad \quad\ x_{1}w_{2}i-x_{1}x_{2}+x_{1}y_{2}k-x_{1}z_{2}j +\\
&\quad \quad\ y_{1}w_{2}j-y_{1}x_{2}k-y_{1}y_{2}+y_{1}z_{2}i +\\
&\quad \quad\ z_{1}w_{2}k+z_{1}x_{2}j-z_{1}y_{2}i-z_{1}z_{2} \\ \\
&\quad=w_{1}w_{2}-x_{1}x_{2}-y_{1}y_{2}-z_{1}z_{2} +\\
&\quad \quad\ (x_{1}w_{2}+w_{1}x_{2}-z_{1}y_{2}+y_{1}z_{2})i +\\
&\quad \quad\ (y_{1}w_{2}+z_{1}x_{2}+w_{1}y_{2}-x_{1}z_{2})j +\\
&\quad \quad\ (z_{1}w_{2}-y_{1}x_{2}+x_{1}y_{2}+w_{1}z_{2})k \\ \\
&\quad
\end{align}
$$

我们可以将结果进一步转化为矩阵形式

$$
q_{1}q_{2}=\begin{bmatrix}
w_{1}& -x_{1} & -y_{1} & -z_{1}\\
x_{1}& w_{1} & -z_{1} &y_{1} \\
y_{1}& z_{1} & w_{1} & -x_{1}\\
z_{1}& -y_{1} & x_{1} &w_{1}
\end{bmatrix}\begin{bmatrix}
w_{2}\\
x_{2} \\
y_{2}\\
z_{2}
\end{bmatrix}
$$

其实四元数相乘的本质也是一个线性转换

接下来我们考虑虚部向量形式的点乘和叉乘，则有

- 点乘

$$
v_{1}·v_{2}=\begin{bmatrix}
x_{1}\\
y_{1}\\
z_{1}
\end{bmatrix}\begin{bmatrix}
x_{2}\\
y_{2}\\
z_{2}
\end{bmatrix}= x_{1}x_{2}+y_{1}y_{2}+z_{1}z_{2}
$$

- 叉乘

$$

v_{1}\times v_{2}=\begin{bmatrix}
x_{1}\\
y_{1}\\
z_{1}
\end{bmatrix}\times \begin{bmatrix}
x_{2}\\
y_{2}\\
z_{2}
\end{bmatrix}= y_{1}z_{2}-z_{1}y_{2}+z_{1}x_{2}-x_{1}z_{2}+x_{1}y_{2}-y_{1}x_{2}
$$

我们将q<sub>1</sub>左乘q<sub>2</sub>结果再变换下

$$
\begin{align}\\
&\quad w_{1}w_{2}-(x_{1}x_{2}+y_{1}y_{2}+z_{1}z_{2}) +\\
&\quad (x_{1}w_{2}+w_{1}x_{2}+y_{1}z_{2}-z_{1}y_{2})i +\\
&\quad (y_{1}w_{2}+w_{1}y_{2}+z_{1}x_{2}-x_{1}z_{2})j +\\
&\quad (z_{1}w_{2}+w_{1}z_{2}+x_{1}y_{2}-y_{1}x_{2})k \\ \\
&\quad
\end{align}
$$

观察后可知，存在以下等式

$$
q_{1}q_{2}=\left [ w_{1}w_{2}-v_{1}·v_{2},w_{2}v_{1}+w_{1}v_{2}+v_{1}\times v_{2} \right ]
$$

这个等式又叫Graβmann Product积

## 点乘

四元数的点乘计算规则与向量相同，得到的结果是一个标量，对应位置乘积之和

$$
q_{1}·q_{2}=\begin{bmatrix}
w_{1} \\
x_{1}\\
y_{1}\\
z_{1}
\end{bmatrix}\begin{bmatrix}
w_{2} \\
x_{2}\\
y_{2}\\
z_{2}
\end{bmatrix}=w_{1}w_{2}+x_{1}x_{2}+y_{1}y_{2}+z_{1}z_{2}
$$

四元数点乘的几何意义与向量点乘的几何意义相似，表示四元数与另一个四元数的`"相似"`程度

## 对数运算

四元数对数运算的结果也是一个四元数

对于四元数`q`，有

$$
\log_{}{q}= \log_{}{\begin{Vmatrix}
q
\end{Vmatrix}\frac{q}{\begin{Vmatrix}
q
\end{Vmatrix}} }=\log_{}{\begin{Vmatrix}
q
\end{Vmatrix}}+\log_{}{\frac{q}{\begin{Vmatrix}
q
\end{Vmatrix}} }
$$



## `轴-角`对

3D中的任意角位移都可以通过绕任意轴的单一旋转来完成，轴-角对表示为`(n,θ)`

实际上，轴-角对是表示旋转的第四种方式，但是在描述轴-角对时一般被欧拉角和四元数替代了

`任意向量v`绕`单位向量n`旋转`θ`后的`向量`可以使用四元数乘法来获得，令

$$
v=\left [ 0,\rm v \right ]
$$

$$
q=\begin{bmatrix}
\cos\frac{\theta }{2}  &n\sin\frac{\theta }{2}
\end{bmatrix}=\begin{bmatrix}
\cos\frac{\theta }{2}  &n_{x} \sin\frac{\theta }{2}&n_{y} \sin\frac{\theta }{2}&n_{z} \sin\frac{\theta }{2}
\end{bmatrix}
$$

则转换后后的向量v<sup>'</sup>为

$$
v^{'}=qvq^{*}=qvq^{-1}
$$

则有

$$
v^{'}=\left [ 0,\cos \theta \rm v+(1-\cos \theta )(u·v)u+\sin \theta (u\times v) \right ]
$$

## 插值



参考：

【1】[Understanding Quaternions](https://www.3dgep.com/understanding-quaternions/)

【2】[四元数与空间旋转](https://zh.wikipedia.org/zh-hans/%E5%9B%9B%E5%85%83%E6%95%B0%E4%B8%8E%E7%A9%BA%E9%97%B4%E6%97%8B%E8%BD%AC#%E5%8D%95%E4%BD%8D%E5%9B%9B%E5%85%83%E6%95%B0%E8%A1%A8%E7%A4%BA%E4%B8%80%E4%B8%AA%E4%B8%89%E7%BB%B4%E7%A9%BA%E9%97%B4%E6%97%8B%E8%BD%AC)

【3】[四元数与三维旋转](https://krasjet.github.io/quaternion/)

【4】[四元数的可视化](https://www.bilibili.com/video/av33385105/?vd_source=c17727dd1d042463032d76bc7914861b)

【5】[如何形象地理解四元数？](https://www.zhihu.com/question/23005815)

【6】[四元数速查手册](https://aipiano.github.io/2019/01/11/%E5%9B%9B%E5%85%83%E6%95%B0%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/)

【7】[欧拉公式](https://zh.wikipedia.org/zh-hans/%E6%AC%A7%E6%8B%89%E5%85%AC%E5%BC%8F)
